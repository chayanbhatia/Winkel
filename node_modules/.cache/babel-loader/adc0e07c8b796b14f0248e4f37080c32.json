{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alizahir/Documents/Programming/Web Development /Personal-projects/Winkel-eCommerce/winkel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/alizahir/Documents/Programming/Web Development /Personal-projects/Winkel-eCommerce/winkel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import jwt from'jsonwebtoken';import firebase from'./Firebase';export var GoogleSignIn=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var provider;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:provider=new firebase.auth.GoogleAuthProvider();return _context.abrupt(\"return\",firebase.auth().signInWithPopup(provider).then(function(result){var db=firebase.firestore();if(result.additionalUserInfo.isNewUser){db.collection('users').doc(result.user.uid).set({name:result.user.displayName,email:result.user.email,uid:result.user.uid,cart:[]},{merge:true});}else{db.collection('users').doc(result.user.uid).set({name:result.user.displayName,email:result.user.email,uid:result.user.uid},{merge:true});}var cart=db.collection('users').doc(result.user.uid).get().then(function(data){var cart=data.data().cart;return cart;});var resultData={name:result.user.displayName,email:result.user.email,uid:result.user.uid,cart:cart};console.log(resultData);var Token=jwt.sign(resultData,process.env.REACT_APP_SECURE_TOKEN_ACCESS_KEY);localStorage.setItem('authToken',Token);return{result:result,cart:cart};}).catch(function(error){return error;}));case 2:case\"end\":return _context.stop();}}},_callee);}));return function GoogleSignIn(){return _ref.apply(this,arguments);};}();export var FacebookSignIn=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var provider;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:provider=new firebase.auth.FacebookAuthProvider();return _context2.abrupt(\"return\",firebase.auth().signInWithPopup(provider).then(function(result){var db=firebase.firestore();db.collection('users').doc(result.user.uid).set({name:result.user.displayName,email:result.user.email,uid:result.user.uid},{merge:true});var resultData={name:result.user.displayName,email:result.user.email,uid:result.user.uid};var Token=jwt.sign(resultData,process.env.REACT_APP_SECURE_TOKEN_ACCESS_KEY);localStorage.setItem('authToken',Token);return result;}).catch(function(error){return error;}));case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function FacebookSignIn(){return _ref2.apply(this,arguments);};}();export var logout=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:localStorage.removeItem('authToken');return _context3.abrupt(\"return\",firebase.auth().signOut().then(function(){return\"Success\";}).catch(function(){return\"Error\";}));case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function logout(){return _ref3.apply(this,arguments);};}();export function verifySecuredToken(_x){return _verifySecuredToken.apply(this,arguments);}function _verifySecuredToken(){_verifySecuredToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(token){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",jwt.verify(token,process.env.NEXT_PUBLIC_SECURE_TOKEN_ACCESS_KEY,function(err,userData){if(err)return null;if(userData.name===(null||undefined)||userData.email===(null||undefined)||userData.uid===(null||undefined))return null;return userData;}));case 1:case\"end\":return _context4.stop();}}},_callee4);}));return _verifySecuredToken.apply(this,arguments);}","map":{"version":3,"sources":["/Users/alizahir/Documents/Programming/Web Development /Personal-projects/Winkel-eCommerce/winkel/src/config/FirebaseAuth.js"],"names":["jwt","firebase","GoogleSignIn","provider","auth","GoogleAuthProvider","signInWithPopup","then","result","db","firestore","additionalUserInfo","isNewUser","collection","doc","user","uid","set","name","displayName","email","cart","merge","get","data","resultData","console","log","Token","sign","process","env","REACT_APP_SECURE_TOKEN_ACCESS_KEY","localStorage","setItem","catch","error","FacebookSignIn","FacebookAuthProvider","logout","removeItem","signOut","verifySecuredToken","token","verify","NEXT_PUBLIC_SECURE_TOKEN_ACCESS_KEY","err","userData","undefined"],"mappings":"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","sourcesContent":["import jwt from 'jsonwebtoken'\nimport firebase from './Firebase'\n\nexport const GoogleSignIn = async () => {\n\n    var provider = new firebase.auth.GoogleAuthProvider();\n    return firebase.auth().signInWithPopup(provider)\n        .then((result) => {\n            const db = firebase.firestore();\n            if (result.additionalUserInfo.isNewUser) {\n                db.collection('users').doc(result.user.uid).set({\n                    name: result.user.displayName,\n                    email: result.user.email,\n                    uid: result.user.uid,\n                    cart: []\n                }, { merge: true });\n            } else {\n                db.collection('users').doc(result.user.uid).set({\n                    name: result.user.displayName,\n                    email: result.user.email,\n                    uid: result.user.uid\n                }, { merge: true });\n            }\n            const cart = db.collection('users').doc(result.user.uid).get().then(data => {\n                const cart = data.data().cart;\n                return cart;\n            })\n            const resultData = {\n                name: result.user.displayName,\n                email: result.user.email,\n                uid: result.user.uid,\n                cart\n            };\n            console.log(resultData)\n            const Token = jwt.sign(resultData, process.env.REACT_APP_SECURE_TOKEN_ACCESS_KEY);\n            localStorage.setItem('authToken', Token);\n            return { result, cart };\n        })\n        .catch((error) => {\n            return error;\n        })\n\n}\nexport const FacebookSignIn = async () => {\n\n    var provider = new firebase.auth.FacebookAuthProvider();\n    return firebase.auth().signInWithPopup(provider)\n        .then((result) => {\n            const db = firebase.firestore();\n            db.collection('users').doc(result.user.uid).set({\n                name: result.user.displayName,\n                email: result.user.email,\n                uid: result.user.uid\n            }, { merge: true });\n            const resultData = {\n                name: result.user.displayName,\n                email: result.user.email,\n                uid: result.user.uid\n            };\n\n            const Token = jwt.sign(resultData, process.env.REACT_APP_SECURE_TOKEN_ACCESS_KEY);\n            localStorage.setItem('authToken', Token);\n\n            return result;\n        })\n        .catch((error) => {\n            return error;\n        })\n\n}\n\nexport const logout = async () => {\n    localStorage.removeItem('authToken');\n    return firebase.auth().signOut().then(() => {\n        return \"Success\";\n    }).catch(() => {\n        return \"Error\"\n    });\n}\n\nexport async function verifySecuredToken(token) {\n\n    return jwt.verify(token, process.env.NEXT_PUBLIC_SECURE_TOKEN_ACCESS_KEY, (err, userData) => {\n\n        if (err)\n            return null;\n        if (userData.name === (null || undefined) || userData.email === (null || undefined) || userData.uid === (null || undefined))\n            return null;\n        return userData;\n    });\n}"]},"metadata":{},"sourceType":"module"}